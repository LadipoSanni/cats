---
- name: Install system dependencies
  apt:
    name: "{{ item }}"
    state: present
  with_items:
    - build-essential
    - curl

- name: Install Ruby
  apt:
    name: ruby-full
    state: present

- name: Install Bundler
  command: gem install bundler

- name: Copy application files
  copy:
    src: "{{ playbook_dir }}/../"
    dest: /app/
    owner: ec2-user
    group: ec2-user
    mode: 0755

- name: Copy start.sh template
  template:
    src: templates/start.sh.j2
    dest: /app/start.sh
    mode: 0755

- name: Install application dependencies
  command: bundle install chdir=/app

- name: Start Application
  shell: /app/start.sh
